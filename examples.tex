\newcommand{\integrityexample}{
% At Call to H
% Memory Layout
\begin{center}
\MemoryLabel{4em}{2em}{0}
\MemoryLabel{21em}{2em}{99}
\MemoryLabel{61.5em}{2em}{\SP}
\memory{3}{gray}[{\makebox[0pt]{Instructions}}]%
\hspace*{3pt}
$\cdots$
\memory{1}{white}[{\makebox[0pt]{Output}}]%
  \memory{6}{red}[{\makebox[0pt]{\(\HIGHINT\)}}]%
  \memory{4}{green}[{\makebox[0pt]{\(\LOWINT\)}}]%
~$\cdots$
\MemoryLabel{-46.5em}{0.75em}{42}
\MemoryLabel{-42.5em}{0.75em}{0}
\MemoryLabel{-38.5em}{0.75em}{0}
\MemoryLabel{-34.5em}{0.75em}{0}
\MemoryLabel{-30.5em}{0.75em}{8}
\MemoryLabel{-26.5em}{0.75em}{}
\MemoryLabel{-22.5em}{0.75em}{17}
\MemoryLabel{-18.5em}{0.75em}{0}
\\
\end{center}
% Starting Register File
\summary{40}{0}{\thepcctr}{108}{17}{?}
\setcounter{pcctr}{40}
\vspace*{0.2em}
% H - Body
\[
\begin{array}{c|c|c|c|c}
  \row{\addi ~ \rsp ~ \rsp ~ 1}{\rsp \leftarrow \rsp + 1}{\rsp \leftarrow 109}
      {Allocate for return address}
  \row{\sw ~ \rsp ~ \rra ~ \negate 1}{[\rsp - 1] \leftarrow \rra}{[108] \leftarrow 27}
      {Store return address}
  \row{\lw ~ r_4 ~ \rsp ~ \negate 3}{r_4 \leftarrow [\rsp - 3]}{r_4 \leftarrow 17}
      {Load the argument {\tt v} to $r_4$}
  \row{\addi ~ r_4 ~ r_4 ~ 1}{r_4 \leftarrow r_4 + 1}{r_4 \leftarrow 18}
      {Increment $r_4$ by 1}
  \row{\sw ~ \rsp ~ r_4 ~ \negate 5}{[\rsp - 5] \leftarrow r_4}{[103] \leftarrow 18}
      {Store $r_4$ to {\tt z}}
  \row{\lw ~ \rra ~ \rsp ~ \negate 1}{\rra \leftarrow [\rsp - 1]}{\rra \leftarrow 27}
      {Load return address}
  \row{\addi ~ \rsp ~ \rsp ~ \negate 1}{\rsp \leftarrow \rsp - 1}{\rsp \leftarrow 108}
      {Restore the stack pointer of {\tt g}}
  \row{\jalr ~ \rra ~ \rra ~ 0}{??}{PC \leftarrow 27}
      {Return to {\tt g}}
  \end{array}
\]
\begin{center}
\MemoryLabel{4em}{2em}{0}
\MemoryLabel{21em}{2em}{99}
\MemoryLabel{44em}{2em}{\SP}
\memory{3}{gray}[{\makebox[0pt]{Instructions}}]%
\hspace*{3pt}
$\cdots$
\memory{1}{white}[{\makebox[0pt]{Output}}]%
  \memory{3}{red}%
  \memory{1}{yellow}%
  \memory{2}{red}%
  \memory{4}{green}%
~$\cdots$
\MemoryLabel{-46.5em}{0.75em}{42}
\MemoryLabel{-42.5em}{0.75em}{0}
\MemoryLabel{-38.5em}{0.75em}{0}
\MemoryLabel{-34.5em}{0.75em}{18}
\MemoryLabel{-30.5em}{0.75em}{8}
\MemoryLabel{-26.5em}{0.75em}{}
\MemoryLabel{-22.5em}{0.75em}{17}
\MemoryLabel{-18.5em}{0.75em}{0}
\MemoryLabel{-16em}{0.75em}{108}
\\
\end{center}
%
}

\newcommand{\integritylazyexample}{
\begin{center}
\MemoryLabel{4em}{2em}{0}
\MemoryLabel{21em}{2em}{99}
\MemoryLabel{61.5em}{2em}{\SP}
\memory{3}{gray}[{\makebox[0pt]{Instructions}}]%
\hspace*{3pt}
$\cdots$
\memory{1}{white}[{\makebox[0pt]{Output}}]%
  \memory{3}{red}%
  \memory{1}{yellow}%
  \memory{2}{red}%
  \memory{4}{green}%
~$\cdots$
\MemoryLabel{-46.5em}{0.75em}{42}
\MemoryLabel{-42.5em}{0.75em}{0}
\MemoryLabel{-38.5em}{0.75em}{0}
\MemoryLabel{-34.5em}{0.75em}{18}
\MemoryLabel{-30.5em}{0.75em}{8}
\MemoryLabel{-26.5em}{0.75em}{}
\MemoryLabel{-22.5em}{0.75em}{17}
\MemoryLabel{-18.5em}{0.75em}{0}
\MemoryLabel{-16em}{0.75em}{108}
\\
\end{center}
%
\begin{center}
\MemoryLabel{4em}{2em}{0}
\MemoryLabel{21em}{2em}{99}
\MemoryLabel{61.5em}{2em}{\SP}
\memory{3}{gray}[{\makebox[0pt]{Instructions}}]%
\hspace*{3pt}
$\cdots$
\memory{1}{white}[{\makebox[0pt]{Output}}]%
  \memory{3}{red}%
  \memory{1}{yellow}%
  \memory{2}{red}%
  \memory{4}{green}%
~$\cdots$
\MemoryLabel{-46.5em}{0.75em}{42}
\MemoryLabel{-42.5em}{0.75em}{0}
\MemoryLabel{-38.5em}{0.75em}{0}
\MemoryLabel{-34.5em}{0.75em}{0}
\MemoryLabel{-30.5em}{0.75em}{8}
\MemoryLabel{-26.5em}{0.75em}{}
\MemoryLabel{-22.5em}{0.75em}{17}
\MemoryLabel{-18.5em}{0.75em}{0}
\MemoryLabel{-16em}{0.75em}{108}
\\
\end{center}
% 
% Starting Register File
\summary{27}{0}{\thepcctr}{108}{18}{?}
\vspace*{0.2em}

\setcounter{pcctr}{27}
% H - Body
\vspace*{0.2em}
\[
\begin{array}{c|c|c|c|c}
  \row{\lw ~ r_4 ~ \rsp ~ 0}{r_4 \leftarrow [\rsp]}{r_4 \leftarrow 18}
      {Load return value to $r_4$}
  \row{\sw ~ \rsp ~ r_4 ~ \negate 3}{[\rsp - 3] \leftarrow r_4}{[105] \leftarrow 18}
      {Set {\tt w} to 18}
  \row{\addi ~ \rsp ~ \rsp ~ \negate 2}{\rsp \leftarrow \rsp - 2}{\rsp \leftarrow 106}
      {Deallocate {\tt h}'s call frame}
  \row{\lw ~ r_5 ~ \rsp ~ \negate 4}{r_5 \leftarrow [\rsp - 4]}{r_5 \leftarrow 18/0}
      {Load argument {\tt z} $r_5$}
  \row{\sw ~ \rout ~ r_5 ~ 0}{[\rout] \leftarrow r_5}{[99] \leftarrow 18/0}
      {Print {\tt z}}      
\end{array}
\]
\[\pi_o(\MPT) \not \eqsim \pi_o(\machOT')\]
}

\newcommand{\confidentialityduringexample}{
% After Return from H
% Memory Layout
\begin{center}
\MemoryLabel{4em}{2em}{0}
\MemoryLabel{21em}{2em}{99}
\MemoryLabel{53em}{2em}{\SP}
\memory{3}{gray}[{\makebox[0pt]{Instructions}}]%
\hspace*{3pt}
$\cdots$
\memory{1}{white}[{\makebox[0pt]{Output}}]%
\memory{2}{red}[{\makebox[0pt]{\HIGHSEC}}]%
\memory{4}{green}[{\makebox[0pt]{\(\LOWSEC\)}}]%
\memory{4}{red}[{\makebox[0pt]{\(\HIGHSEC\)}}]%
~$\cdots$
\MemoryLabel{-46.5em}{0.75em}{42}
\MemoryLabel{-42.5em}{0.75em}{0}
\MemoryLabel{-38.5em}{0.75em}{0}
\MemoryLabel{-34.5em}{0.75em}{0}
\MemoryLabel{-30.5em}{0.75em}{8}
\MemoryLabel{-26.5em}{0.75em}{18}
\MemoryLabel{-22.5em}{0.75em}{17}
\MemoryLabel{-18.5em}{0.75em}{18}
\MemoryLabel{-16em}{0.75em}{108}
\\
\end{center}
\begin{center}
\MemoryLabel{4em}{2em}{0}
\MemoryLabel{21em}{2em}{99}
\MemoryLabel{53em}{2em}{\SP}
\memory{3}{gray}[{\makebox[0pt]{Instructions}}]%
\hspace*{3pt}
$\cdots$
\memory{1}{white}[{\makebox[0pt]{Output}}]%
\memory{2}{yellow}[{\makebox[0pt]{Varied}}]%
\memory{4}{green}%
\memory{3}{pink}[{\makebox[0pt]{Set by {\tt h}}}]%
\memory{1}{yellow}%
~$\cdots$
\MemoryLabel{-46.5em}{0.75em}{?}
\MemoryLabel{-42.5em}{0.75em}{?}
\MemoryLabel{-38.5em}{0.75em}{0}
\MemoryLabel{-34.5em}{0.75em}{0}
\MemoryLabel{-30.5em}{0.75em}{8}
\MemoryLabel{-26.5em}{0.75em}{18}
\MemoryLabel{-22.5em}{0.75em}{17}
\MemoryLabel{-18.5em}{0.75em}{18}
\MemoryLabel{-16em}{0.75em}{108}
\\
\end{center}

% Starting Register File
\summary{30}{0}{\thepcctr}{106}{18}{?}
\vspace*{0.2em}

\setcounter{pcctr}{30}
% G - Body
\vspace*{0.2em}
\[
\begin{array}{c|c|c|c|c}
  \row{\lw ~ r_5 ~ \rsp ~ \negate 6}{r_5 \leftarrow [\rsp - 6]}{r_5 \leftarrow 42/?}
      {Load {\tt main}'s secret, {\tt x} to $r_5$}
  \row{\sw ~ \rout ~ r_5 ~ 0}{[\rout] \leftarrow r_5}{[99] \leftarrow 42?}
      {Print {\tt x}}
  \row{\lw ~ r_5 ~ \rsp ~ \negate 4}{r_5 \leftarrow [\rsp - 4]}{r_5 \leftarrow 0}
      {Load argument {\tt z} to $r_5$}
  \row{\add ~ r_4 ~ r_4 ~ r_5}{r_4 \leftarrow r_4 + r_5}{r_4 \leftarrow 18}
      {Add $r_4$ and $r_5$}
  \row{\sw ~ \rsp ~ r_4 ~ \negate 3}{[\rsp - 3] \leftarrow r_4}{[103] \leftarrow 18}
      {Store $r_4$ as the return of {\tt g}}
  \row{\lw ~ \rra ~ \rsp ~ \negate 2}{\rra \leftarrow [\rsp - 2]}{\rra \leftarrow 8}
      {Load return address}
  \row{\addi ~ \rsp ~ \rsp ~ \negate 2}{\rsp \leftarrow \rsp - 2}{\rsp \leftarrow 104}
      {Deallocate {\tt g}'s local state}
  \row{\jalr ~ \rra ~ \rra ~ 0}{??}{PC \leftarrow 8}{Return to {\tt main}}
\end{array}
\]

  \[\pi_o(\MPT) \not \eqsim \pi_o(\machOT') \text{ when } ? \not = 42\]
}

\newcommand{\confidentialityendexample}{
% At Call to H
% Memory Layout
\begin{center}
\MemoryLabel{4em}{2em}{0}
\MemoryLabel{21em}{2em}{99}
\MemoryLabel{61.5em}{2em}{\SP}
\memory{3}{gray}[{\makebox[0pt]{Instructions}}]%
\hspace*{3pt}
$\cdots$
\memory{1}{white}[{\makebox[0pt]{Output}}]%
\memory{6}{red}[{\makebox[0pt]{\(\HIGHSEC\)}}]%
\memory{2}{green}[{\makebox[0pt]{\(\LOWSEC\)}}]%
\memory{2}{red}[{\makebox[0pt]{\(\HIGHSEC\)}}]
~$\cdots$
\MemoryLabel{-46.5em}{0.75em}{42}
\MemoryLabel{-42.5em}{0.75em}{0}
\MemoryLabel{-38.5em}{0.75em}{0}
\MemoryLabel{-34.5em}{0.75em}{0}
\MemoryLabel{-30.5em}{0.75em}{8}
\MemoryLabel{-26.5em}{0.75em}{}
\MemoryLabel{-22.5em}{0.75em}{17}
\MemoryLabel{-18.5em}{0.75em}{0}
\\
\end{center}
% Variant
\begin{center}
\MemoryLabel{4em}{2em}{0}
\MemoryLabel{21em}{2em}{99}
\MemoryLabel{61.5em}{2em}{\SP}
\memory{3}{gray}%
\hspace*{3pt}
$\cdots$
\memory{1}{white}%
  \memory{6}{yellow}[{\makebox[0pt]{Varied}}]%
  \memory{2}{green}%
\memory{2}{yellow}%[{\makebox[0pt]{Uninitialized}}]
~$\cdots$
\MemoryLabel{-46.5em}{0.75em}{?}
\MemoryLabel{-42.5em}{0.75em}{?}
\MemoryLabel{-38.5em}{0.75em}{?}
\MemoryLabel{-34.5em}{0.75em}{?}
\MemoryLabel{-30.5em}{0.75em}{?}
\MemoryLabel{-26.5em}{0.75em}{?}
\MemoryLabel{-22.5em}{0.75em}{17}
\MemoryLabel{-18.5em}{0.75em}{0}
\\
\end{center}

% Starting Register File
\summary{40}{0}{\thepcctr}{108}{17}{?}
\setcounter{pcctr}{40}
\vspace*{0.2em}
% H - Body
\[
\begin{array}{c|c|c|c|c}
  \row{\addi ~ \rsp ~ \rsp ~ 1}{\rsp \leftarrow \rsp + 1}{\rsp \leftarrow 109}
      {Allocate for return address}
  \row{\sw ~ \rsp ~ \rra ~ \negate 1}{[\rsp - 1] \leftarrow \rra}{[108] \leftarrow 27}
      {Store return address}
  \row{\lw ~ r_4 ~ 100}{r_4 \leftarrow 100}{r_4 \leftarrow 42/?}
      {Load {\tt main}'s secret {\tt x} to $r_4$}
  \row{\addi ~ r_4 ~ r_4 ~ 1}{r_4 \leftarrow r_4 + 1}{r_4 \leftarrow 43/(?+1)}
      {Increment $r_4$ by 1}
  \row{\sw ~ \rsp ~ r_4 ~ \negate 2}{[\rsp - 2] \leftarrow r_4}{[107] \leftarrow 43/(?+1)}
      {Store $r_4$ as the return value}
  \row{\lw ~ \rra ~ \rsp ~ \negate 1}{\rra \leftarrow [\rsp - 1]}{\rra \leftarrow 27}
      {Load return address}
  \row{\addi ~ \rsp ~ \rsp ~ \negate 1}{\rsp \leftarrow \rsp - 1}{\rsp \leftarrow 108}
      {Restore the stack pointer of {\tt g}}
  \row{\jalr ~ \rra ~ \rra ~ 0}{??}{PC \leftarrow 27}
      {Return to {\tt g}}
  \end{array}
\]

\begin{center}
\MemoryLabel{4em}{2em}{0}
\MemoryLabel{21em}{2em}{99}
\MemoryLabel{61.5em}{2em}{\SP}
\memory{3}{gray}%
\hspace*{3pt}
$\cdots$
\memory{1}{white}%
  \memory{6}{red}%
  \memory{1}{green}%
  \memory{2}{pink}%
\memory{1}{red}%[{\makebox[0pt]{Uninitialized}}]
~$\cdots$
\MemoryLabel{-46.5em}{0.75em}{42}
\MemoryLabel{-42.5em}{0.75em}{0}
\MemoryLabel{-38.5em}{0.75em}{0}
\MemoryLabel{-34.5em}{0.75em}{0}
\MemoryLabel{-30.5em}{0.75em}{8}
\MemoryLabel{-26.5em}{0.75em}{}
\MemoryLabel{-22.5em}{0.75em}{17}
\MemoryLabel{-19em}{0.75em}{43}
\MemoryLabel{-16em}{0.75em}{108}
\\
\end{center}

%
\begin{center}
\MemoryLabel{4em}{2em}{0}
\MemoryLabel{21em}{2em}{99}
\MemoryLabel{61.5em}{2em}{\SP}
\memory{3}{gray}%
\hspace*{3pt}
$\cdots$
\memory{1}{white}%
  \memory{6}{yellow}%
  \memory{1}{green}%
  \memory{2}{pink}%
\memory{1}{yellow}%[{\makebox[0pt]{Uninitialized}}]
~$\cdots$
\MemoryLabel{-46.5em}{0.75em}{?}
\MemoryLabel{-42.5em}{0.75em}{?}
\MemoryLabel{-38.5em}{0.75em}{?}
\MemoryLabel{-34.5em}{0.75em}{?}
\MemoryLabel{-30.5em}{0.75em}{?}
\MemoryLabel{-26.5em}{0.75em}{?}
\MemoryLabel{-22.5em}{0.75em}{17}
\MemoryLabel{-19em}{0.75em}{?}
\MemoryLabel{-16em}{0.75em}{108}
\\
\end{center}
%
}

\newcommand{\confidentialitylazyexample}{
\begin{center}
\MemoryLabel{4em}{2em}{0}
\MemoryLabel{21em}{2em}{99}
\MemoryLabel{61.5em}{2em}{\SP}
\memory{3}{gray}%
\hspace*{3pt}
$\cdots$
\memory{1}{white}%
  \memory{6}{red}%
  \memory{1}{green}%
  \memory{2}{pink}%
\memory{1}{red}%[{\makebox[0pt]{Uninitialized}}]
~$\cdots$
\MemoryLabel{-46.5em}{0.75em}{42}
\MemoryLabel{-42.5em}{0.75em}{0}
\MemoryLabel{-38.5em}{0.75em}{0}
\MemoryLabel{-34.5em}{0.75em}{0}
\MemoryLabel{-30.5em}{0.75em}{8}
\MemoryLabel{-26.5em}{0.75em}{}
\MemoryLabel{-22.5em}{0.75em}{17}
\MemoryLabel{-19em}{0.75em}{43}
\MemoryLabel{-16em}{0.75em}{108}
\\
\end{center}

%
\begin{center}
\MemoryLabel{4em}{2em}{0}
\MemoryLabel{21em}{2em}{99}
\MemoryLabel{61.5em}{2em}{\SP}
\memory{3}{gray}%
\hspace*{3pt}
$\cdots$
\memory{1}{white}%
  \memory{6}{yellow}%
  \memory{1}{green}%
  \memory{2}{pink}%
\memory{1}{yellow}%[{\makebox[0pt]{Uninitialized}}]
~$\cdots$
\MemoryLabel{-46.5em}{0.75em}{42}
\MemoryLabel{-42.5em}{0.75em}{0}
\MemoryLabel{-38.5em}{0.75em}{0}
\MemoryLabel{-34.5em}{0.75em}{0}
\MemoryLabel{-30.5em}{0.75em}{8}
\MemoryLabel{-26.5em}{0.75em}{}
\MemoryLabel{-22.5em}{0.75em}{17}
\MemoryLabel{-19em}{0.75em}{?}
\MemoryLabel{-16em}{0.75em}{108}
\\
\end{center}
%
\summary{27}{0}{\thepcctr}{108}{18}{?}
\vspace*{0.2em}

\setcounter{pcctr}{27}
% H - Body
\vspace*{0.2em}
\[
\begin{array}{c|c|c|c|c}
  \row{\lw ~ r_4 ~ \rsp ~ 0}{r_4 \leftarrow [\rsp]}{r_4 \leftarrow 43/?}
      {Load return value to $r_4$}
  \row{\sw ~ \rsp ~ r_4 ~ \negate 3}{[\rsp - 3] \leftarrow r_4}{[105] \leftarrow 43/?}
      {Set {\tt w} to returned value}
  \row{\addi ~ \rsp ~ \rsp ~ \negate 2}{\rsp \leftarrow \rsp - 2}{\rsp \leftarrow 106}
      {Deallocate {\tt h}'s call frame}
  \row{\lw ~ r_5 ~ \rsp ~ \negate 4}{r_5 \leftarrow [\rsp - 4]}{r_5 \leftarrow 0}
      {Load argument {\tt z} $r_5$}
  \row{\sw ~ \rout ~ r_5 ~ 0}{[\rout] \leftarrow r_5}{[99] \leftarrow 0}
      {Print {\tt z}}
  \row{\add ~ r_4 ~ r_4 ~ r_5}{r_4 \leftarrow r_4 + r_5}{r_4 \leftarrow 51/?}
      {Add $r_4$ and $r_5$}
  \row{\sw ~ \rsp ~ r_4 ~ \negate 3}{[\rsp - 3] \leftarrow r_4}{[103] \leftarrow 51/?}
      {Store $r_4$ as ther return of {\tt g}}
  \row{\lw ~ \rra ~ \rsp ~ \negate 2}{\rra \leftarrow [\rsp - 2]}{\rra \leftarrow 8}
      {Load return address}
  \row{\addi ~ \rsp ~ \rsp ~ \negate 2}{\rsp \leftarrow \rsp - 2}{\rsp \leftarrow 104}
      {Deallocate {\tt g}'s local state}
  \row{\jalr ~ \rra ~ \rra ~ 0}{??}{PC \leftarrow 8}{Return to {\tt main}}
\end{array}
\]
\setcounter{pcctr}{8}
\[
\begin{array}{c|c|c|c|c}
  \row{\lw ~ \rsp ~ r_4 ~ \negate 1}{r_4 \leftarrow [\rsp - 1]}{r_4 \leftarrow 53/?}
      {Load return value to $r_4$}
  \row{\sw ~ \rsp ~ r_4 ~ \negate 3}{[\rsp - 3] \leftarrow r_4}{[101] \leftarrow 53/?}
      {Set {\tt y} to the result}
  \row{\addi ~ \rsp ~ \rsp ~ \negate 4}{\rsp \leftarrow \rsp - 2}{\rsp \leftarrow 102}
      {Deallocate {\tt g}'s call frame}
  \row{\lw ~ \rsp ~ r_5 ~ \negate 2}{r_5 \leftarrow [\rsp - 2]}{r_5 \leftarrow 42}
      {Load {\tt x} to $r_5$}
  \row{\add ~ r_4 ~ r_4 ~ r_5}{r_4 \leftarrow r_4 + r_5}{r_4 \leftarrow 95}
      {Add {\tt x} and {\tt y}}
  \row{\sw ~ \rout ~ r_4 ~ 0}{[\rout] \leftarrow r_4}{[99] \leftarrow 95}
      {Print {\tt x + y}}
\end{array}
\]

\[\pi_o(\MPT) \not \eqsim \pi_o(\machOT)\]
}
